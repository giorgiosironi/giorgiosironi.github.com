<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>CDNs as Code</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <style type="text/css">
        .variables {
            background-color: #cc6666;
        }
        img {
            border: none !important;
        }
        </style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
                    <h1>CDN as Code</h1>
                    <h3>Giorgio Sironi - SETI@eLife</h3>
                    <a href="https://elifesciences.org"><img src="img/logo.png" style="width: 20%;" /></a>
                    <h6>(if you're reading this on your laptop, press S for notes)</h6>
                    <aside class="notes">

                    </aside>
                </section>

                <section>
                  <p>Giorgio Sironi (<a href="https://twitter.com/giorgiosironi">@giorgiosironi</a>)</p>
                  <div style="float: right; width: 20%" />
                      <a href="https://twitter.com/giorgiosironi"><img src="img/elife_squared.jpg" style="float: right; width: 100%;" /></a>
                      <a href="https://elifesciences.org"><img src="img/elife-logo.jpg" style="float: right; width: 100%" alt="I work for eLife Sciences" /></a>
                      <div style="float: right; width: 100%" />
                          <img src="img/it.png" style="width: 45%" alt="Italy" />
                          <img src="img/eu.jpg" style="width: 45%" alt="European Union" />
                      </div>
                  </div>
                  <div style="float: left; width: 80%; margin-top: 5%"> 
                      <ul class="build">
                        <li>Software Engineer in Tools and Infrastructure</li>
                        <li>What do I do
                            <ul>
                            <li>Distributed systems</li>
                            <li>Automated complex tests, integrating many different projects</li>
                            <li>Continuous Delivery</li>
                            <li>Pasta and risotto</li>
                            </ul>
                        </li>
                      </ul>
                  </div>
                  <aside class="notes">
                      I am a SETI, working on build/tooling/deployment problems. As such, I put together projects inside distributed systems, help test their integration and other non-functional requirements; with the goal of deploying new versions every hour without breaking.
                  </aside>
                </section>

                <section>
                    <section>
                        2017
                        <img src="img/despacito.jpg" />
                      <aside class="notes">
                      </aside>
                    </section>
                        
                    <section>
                        <img src="img/homepage.png" />
                      <aside class="notes">
    -- scientific journal
    -- new website just launched
                      </aside>
                    </section>

                    <section>
                        <img src="img/aws.png" />
                      <aside class="notes">
    -- host of AWS technologies and lock in, CloudFront as a CDN, CloudFormation for managing everything declaratively
                      </aside>
                    </section>

                    <section>
- what's a CDN?
                      <aside class="notes">
                          someone else is making a lot of copies of your web pages across the world
                      </aside>
                    </section>
                    <section>
- what's Infrastructure as Code?
                      <aside class="notes">
                          your servers are in Git
                      </aside>
                    </section>
                </section>

                <section>
                    <section>
                        Boss emoji
                      <aside class="notes">
                      </aside>
                    </section>

                    <section>
                        <img src="img/fastly.png" />
                      <aside class="notes">
--- so cool, and it takes minutes to change its configuration rather than >1 hour with CloudFront
                      </aside>
                    </section>

                    <section>
                        <img src="img/fastly_panel.png" />
                      <aside class="notes">
-- point and click in a panel
                      </aside>
                    </section>

                    <section>
                        <img src="img/point-and-click.jpg" />
                      <aside class="notes">
--- horrible and unreproducible
--- especially reproducibility for testing
                      </aside>
                      
                    </section>

                    <section>
                        <img src="img/homer-bush.jpg" />
                      <aside class="notes">
                      </aside>
                      
                    </section>

                </section>
                <section>
                    <section>
                        <img src="img/fastly_api.png" />
                      <aside class="notes">
-- check out Fastly APIs
--- LOTS of work to create everything there, and to maintain it and do a diff and delete it
--- sounds like a common problem
                      </aside>
                    </section>

                    <section>
                        <img src="img/terraform.png" />
                      <aside class="notes">
-- Terraform provider
                      </aside>
                    </section>

                    <section>
                        <img src="img/cloudformation.png" />
                      <aside class="notes">
but we use CloudFormation
--- we use Python code to generate CloudFormation templates
--- so why not start from the same description and generate also Terraform resources?
                      </aside>
                    </section>

                    <section>
                        Limitations
                        <ul>
                            <li></li>
                        </ul>
                      <aside class="notes">
-- limitations
--- one runs after the other (or concurrently if you hate your life); no dependency resolution across the two (DNS in CloudFormation, Fastly services using them in Terraform)
--- using Terraform by running an external process rather than some kind of binding, unparseable output
---- at least input is clear, .tf.json files
                      </aside>
                    </section>
                </section>

                <section>
                    <section>
                        single source of truth
                        <img src="collina.jpg" />
                      <aside class="notes">
-- keeping a single source of truth in the form of a Git repository
--- gets applied to various providers (AWS, Fastly) through various tools (CloudFormation, Terraform)
--- hopefully fewer tools than providers
                      </aside>
                    </section>

                    <section>
                        testing environments
                        <img src="massproduction" />
                      <aside class="notes">
-- testing environments
--- exact same code, customize the domain (`end2end--journal.elifesciences.org` or `staging--journal.elifesciences.org`)
---- points to completely separate resources: servers but also DNS entries or other entities like S3 buckets
                      </aside>
                    </section>

                    <section>
                        process
                      <aside class="notes">
--- manual: infrastructure changes can easily delete a production database
---- start with end2end, re-run automated tests afterwards
---- apply to staging, do exploratory tests if you need to confirm everything works as expected
---- apply to prod
---- user monitoring
                      </aside>
                    </section>

                    <section>
-- wait, logs?
                      <aside class="notes">
--- CDN can deliver to various destination: S3, Google Cloud Storage, BigQuery
--- more infrastructure as code: create the buckets or the BigQuery datasets
---- thankfully with Terraform there is the Google Cloud provider included
---- validates this new approach is scalable to even more providers
--- BigQuery almost real time, buckets every minute or other interval
                      </aside>
                    </section>
                </section>

                <section>
                    <section>
                        Developer
                        A redirect?
                        We can do it with VCL
                      <aside class="notes">
- additional part with VCL
-- introduce Developer

                      </aside>
                    </section>

                    <section>
                        https://github.com/elifesciences/builder/blob/master/src/buildercore/fastly/vcl/journal-submit.vcl.tpl
                      <aside class="notes">
-- templating of custom language and its integration with Terraform
                      </aside>
                    </section>

                    <section>
                        <img src="img/commits.png" />
                      <aside class="notes">
-- Developer contributing to the Infrastructure as Code layer
 `git log | grep -o "Author: [^ ]*" | sort | uniq -c | sort -rn`
                        2283
                        728
                        89
                        8
                        7
                        7
                        4
                        4
                        3
                        2
                        2
                        1
                        1
                        1
                      </aside>
                    </section>

                    <section>
                      <aside class="notes">
                          platform, not integration
                      </aside>
                    </section>
                </section>

                <section>
                    <h1>Thanks!</h1>
                </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
